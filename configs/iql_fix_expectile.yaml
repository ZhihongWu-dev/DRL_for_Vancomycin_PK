# IQLé…ç½® - ä¿®å¤ Expectile çº¦æŸ
# 
# é—®é¢˜è¯Šæ–­ï¼ˆexp_stable_v3ï¼‰ï¼š
#   âœ… æ•°å€¼ç¨³å®šæ€§å·²è¾¾æˆ: std(Q-V)=4.32, max(Q-V)=10.35
#   âŒ Expectile çº¦æŸè¢«ç ´å: Positive%=7.5% (ç›®æ ‡30%)
#   âŒ V ç³»ç»Ÿæ€§è¿‡é«˜: mean(Q-V)=-6.72, Q75(Q-V)=-4.46
#
# æ ¹æœ¬åŸå› ï¼š
#   V ç½‘ç»œå­¦ä¹ ç‡å¤ªé«˜ï¼Œå¯¼è‡´ V "çˆ¬åˆ° Q çš„ä¸ŠåŒ…ç»œ"
#   V ä¸å†æ»¡è¶³ tau=0.7 çš„ expectile çº¦æŸ
#
# ä¿®å¤ç­–ç•¥ï¼š
#   1. ğŸ”§ é™ä½ V å­¦ä¹ ç‡åˆ° 0.3x (ä» 0.0001 â†’ 0.00003)
#   2. ğŸ”§ ä¿æŒæ‰€æœ‰æ•°å€¼ç¨³å®šåŒ–æªæ–½
#   3. ğŸ”§ å¢å¼ºç›‘æ§ï¼šQ-V åˆ†ä½æ•° (Q25/Q50/Q75)
#   4. ğŸ”§ Expectile çº¦æŸéªŒè¯ï¼šP(Q>V) â‰ˆ 1-tau
#
# æœŸæœ›ç»“æœï¼ˆtau=0.7ï¼‰:
#   Positive%   â‰ˆ 28% ~ 32%  (1-tau)
#   Q70(Q-V)    â‰ˆ 0
#   Q75(Q-V)    â‰ˆ 1 ~ 3 (å°æ­£æ•°)
#   Mean(Q-V)   â‰ˆ -2 ~ 0
#   Std(Q-V)    â‰ˆ 3 ~ 8
#   Max(Q-V)    â‰ˆ 10 ~ 15

data:
  path: intermediate_data/ready_data.csv
  sheet: 0
  state_cols:
    - vanco_level(ug/mL)
    - creatinine(mg/dL)
    - wbc(K/uL)
    - bun(mg/dL)
    - temperature
    - sbp
    - heart_rate

train:
  seed: 42
  total_steps: 12000              # ç¨å¾®å»¶é•¿è®­ç»ƒ
  batch_size: 64
  log_interval: 50
  ckpt_interval: 500
  buffer_capacity: 10000
  policy_warmup_steps: 3000       # å‰3000æ­¥å†»ç»“policy

model:
  hidden: [256, 256]
  lr: 0.0001                      # Q å’Œ Pi å­¦ä¹ ç‡
  v_lr_ratio: 0.3                 # ğŸ”§ V lr = 0.3 * Q lr = 0.00003
  gamma: 0.99
  tau: 0.7                        # V = 70%åˆ†ä½æ•° -> æœŸæœ›30% positive
  beta: 1.0                       # ä¿å®ˆçš„beta
  weight_clip: 20.0
  reward_scale: 0.1               # ç¼©æ”¾rewardé˜²æ­¢Qçˆ†ç‚¸
  use_target_q: true              # å¯ç”¨target Q network
  target_update_rate: 0.005       # Polyak averaging rate

workdir: algorithms/iql/runs/exp_fix_expectile

