# IQL配置 - Expectile 修复 v3
#
# 变更：
#   1) 修复 expectile_loss 权重（diff>0 使用 tau）
#   2) v_lr_ratio 降为 0.1，减缓 V 过快上升
#   3) reward_scale 调回 0.1，避免 Q 偏低/偏高
#
# 目标（tau=0.7）：
#   Positive% ≈ 28% ~ 32%
#   Mean(Q-V) ≈ -2 ~ 0
#   Std(Q-V)  ≈ 3 ~ 8


data:
  path: intermediate_data/ready_data.xlsx
  sheet: 0
  state_cols:
    - vanco_level(ug/mL)
    - creatinine(mg/dL)
    - wbc(K/uL)
    - bun(mg/dL)
    - temperature
    - sbp
    - heart_rate

train:
  seed: 42
  total_steps: 10000
  batch_size: 256
  log_interval: 50
  ckpt_interval: 100
  buffer_capacity: 10000
  policy_warmup_steps: 0
  disable_policy: false
  pos_rate_smooth_window: 10
  policy_enable_min_steps: 500
  policy_enable_patience: 3
  policy_enable_pos_ma_min: 0.40
  policy_enable_pos_ma_max: 0.50

model:
  hidden: [256, 256]
  lr: 0.00005 
  v_lr_ratio: 1.3 
  gamma: 0.99
  tau: 0.6
  beta: 3.0
  weight_clip: 20.0
  reward_scale: 0.005
  use_target_q: true
  target_update_rate: 0.005

workdir: algorithms/iql/runs/exp_fix_expectile_v3
